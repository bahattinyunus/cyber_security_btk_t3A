# ğŸ§ª TERSÄ°NE MÃœHENDÄ°SLÄ°K: ZararlÄ± YazÄ±lÄ±m Analizi (Malware Analysis)

> "Kodu okumak yetmez; makinenin zihnini anlamak gerekir. Bir 'ikili' (binary) dosyasÄ±nÄ±n sessizliÄŸi, arkasÄ±ndaki niyetin gÃ¼rÃ¼ltÃ¼sÃ¼dÃ¼r."

---

## ğŸ”¬ Analiz Metodolojisi

ZararlÄ± yazÄ±lÄ±m analizi, bir kod parÃ§asÄ±nÄ±n ne yaptÄ±ÄŸÄ±nÄ±, nasÄ±l Ã§alÄ±ÅŸtÄ±ÄŸÄ±nÄ± ve sisteme olan etkisini anlamak iÃ§in yapÄ±lan derinlemesine araÅŸtÄ±rmadÄ±r.

### 1. Statik Analiz (Static Analysis)
Kod Ã§alÄ±ÅŸtÄ±rÄ±lmadan yapÄ±lan analizdir.
- **File Signatures**: `magic` numaralarÄ± ve dosya tÃ¼rÃ¼ tespiti.
- **Strings Analysis**: Dosya iÃ§indeki okunabilir metinler (IP'ler, URL'ler, fonksiyon isimleri).
- **Hashing**: Ã–rneklerin parmak izini alma (MD5, SHA256).

### 2. Dinamik Analiz (Dynamic Analysis)
Kodun kontrollÃ¼ bir ortamda (Sandbox) Ã§alÄ±ÅŸtÄ±rÄ±larak izlenmesi.
- **Behavioral Analysis**: Dosya sistemi deÄŸiÅŸiklikleri, aÄŸ trafiÄŸi, registry modifikasyonlarÄ±.
- **Process Monitoring**: `Procmon` ve `Sysmon` kullanÄ±mÄ±.

### 3. Tersine MÃ¼hendislik (Code Analysis)
DerlenmiÅŸ kodun (Binary) insan tarafÄ±ndan okunabilir hale getirilmesi (Disassembly/Decompilation).
- **Control Flow**: Kodun dallanma ve mantÄ±k yapÄ±sÄ±nÄ± anlama.
- **Unpacking**: SÄ±kÄ±ÅŸtÄ±rÄ±lmÄ±ÅŸ veya ÅŸifrelenmiÅŸ zararlÄ±larÄ±n aÃ§Ä±lmasÄ±.

---

## ğŸ› ï¸ Analiz TezgÃ¢hÄ± (Tools)

| AraÃ§ | Kategori | KullanÄ±m AmacÄ± |
| :--- | :--- | :--- |
| **Ghidra** | Decompiler | NSA tarafÄ±ndan geliÅŸtirilen tersine mÃ¼hendislik aracÄ±. |
| **x64dbg** | Debugger | Dinamik hata ayÄ±klama ve kod izleme. |
| **Wireshark** | Network | ZararlÄ±nÄ±n dÄ±ÅŸ dÃ¼nya ile iletiÅŸimini izleme. |
| **PEStudio** | Static | PE dosyalarÄ±nÄ±n hÄ±zlÄ± statik analizi. |
| **Any.Run** | Sandbox | EtkileÅŸimli bulut tabanlÄ± analiz. |

## ğŸ—ï¸ Ä°kili Dosya FormatlarÄ± (Binary Formats)

ZararlÄ± yazÄ±lÄ±mlar iÅŸletim sistemine gÃ¶re farklÄ± yapÄ±lar kullanÄ±r.

| Ã–zellik | PE (Portable Executable) | ELF (Executable & Linkable Format) |
| :--- | :--- | :--- |
| **Ä°ÅŸletim Sistemi** | Windows | Linux / Android |
| **GiriÅŸ NoktasÄ±** | `AddressOfEntryPoint` | `e_entry` |
| **BÃ¶lÃ¼mler** | `.text` (Kod), `.data` (Veri), `.rsrc` (Kaynaklar) | `.text`, `.rodata`, `.plt`, `.got` |
| **Analiz AracÄ±** | `PE-bear`, `CFF Explorer` | `readelf`, `nm`, `objdump` |

---

## ğŸ›¡ï¸ Anti-Analiz & Unpacking (Paket AÃ§ma)

GeliÅŸmiÅŸ zararlÄ± yazÄ±lÄ±mlar analiz edilmemek iÃ§in kendini gizler.

### 1. Obfuscation (KarmaÅŸÄ±klaÅŸtÄ±rma)
- **String Encryption**: Statik analizi engellemek iÃ§in metinlerin (Ã¶rn: IP adresleri, komutlar) ÅŸifrelenmiÅŸ halde saklanmasÄ±.
- **Dead Code Insertion**: Analizciyi yanÄ±ltmak iÃ§in Ã§alÄ±ÅŸmayan anlamsÄ±z kod bloklarÄ± ekleme.

### 2. Packers (Paketleyiciler)
DosyanÄ±n diskteki boyutunu kÃ¼Ã§Ã¼ltmek ve kodun okunmasÄ±nÄ± engellemek iÃ§in kullanÄ±lÄ±r.
- **UPX**: En yaygÄ±n paketleyici. `upx -d file.exe` ile kolayca aÃ§Ä±labilir.
- **Custom Packers**: Standart araÃ§larla aÃ§Ä±lamayan, unpacker kodu dosyanÄ±n iÃ§ine gÃ¶mÃ¼lÃ¼ olan yapÄ±lar.

---

## ğŸ“’ Cheat Sheet: Common Windows API Calls (Analyzers)

ZararlÄ± yazÄ±lÄ±mlarÄ±n sistemle etkileÅŸime girerken en sÄ±k kullandÄ±ÄŸÄ± fonksiyonlar:

| API Fonksiyonu | Kategori | ZararlÄ± KullanÄ±m Senaryosu |
| :--- | :--- | :--- |
| **CreateRemoteThread** | Injection | BaÅŸka bir prosese kod enjekte etmek. |
| **IsDebuggerPresent** | Anti-Debug | Analiz edildiÄŸini anlayÄ±p Ã§alÄ±ÅŸmayÄ± durdurmak. |
| **GetTickCount** | Anti-VM | Zaman farkÄ±ndan sanal makinede olduÄŸunu anlamak. |
| **URLDownloadToFile** | Downloader | Ä°nternetten ikinci aÅŸama payload indirmek. |
| **CryptEncrypt** | Ransomware | DosyalarÄ± ÅŸifrelemek iÃ§in MS Kripto API kullanÄ±mÄ±. |
| **SetWindowsHookEx** | Keylogging | Klavye hareketlerini izlemek (Hooking). |

---

## ğŸ¤– Tehdit Tespitinde Yapay Zeka (AI/ML)

Geleneksel imza tabanlÄ± tespitler artÄ±k yetersizdir. Modern AV/EDR sistemleri makine Ã¶ÄŸrenmesi kullanÄ±r.

### 1. ML Tespit Modelleri
Sistem, bir dosyanÄ±n zararlÄ± olup olmadÄ±ÄŸÄ±na karar verirken ÅŸu Ã¶zelliklere (features) bakar:
- **Entropy Analysis**: Dosya iÃ§indeki verinin rastgelelik oranÄ± (YÃ¼ksek entropi = ÅifrelenmiÅŸ/PaketlenmiÅŸ veri).
- **API Call Frequency**: `CreateRemoteThread` gibi kritik API'lerin ne sÄ±klÄ±kla ve hangi sÄ±rayla Ã§aÄŸrÄ±ldÄ±ÄŸÄ±.
- **Import Table Anomalies**: ÅÃ¼pheli veya alÄ±ÅŸÄ±lmadÄ±k kÃ¼tÃ¼phane baÄŸÄ±mlÄ±lÄ±klarÄ±.

### 2. Adversarial AI (Yapay Zekaya SaldÄ±rÄ±)
SaldÄ±rganlar, tespit modellerini yanÄ±ltmak iÃ§in Ã§alÄ±ÅŸÄ±r.
- **Model Poisoning**: EÄŸitim verisini manipÃ¼le ederek zararlÄ±yÄ± "temiz" gÃ¶sterme.
- **Evasion Attacks**: ZararlÄ± koda, modeli yanÄ±ltacak anlamsÄ±z ama "iyi huylu" kod bloklarÄ± ekleme.

---

## ğŸ”¬ Ä°leri Seviye Tersine MÃ¼hendislik (Reverse Engineering)

Kodun sadece ne yaptÄ±ÄŸÄ±nÄ± deÄŸil, nasÄ±l tasarlandÄ±ÄŸÄ±nÄ± anlamak.

### 1. Ghidra/IDA Analiz Ã–rÃ¼ntÃ¼leri
Montaj (Assembly) dilindeki yapÄ±larÄ± yÃ¼ksek seviyeli dile geri dÃ¶ndÃ¼rme:
- **C++ SÄ±nÄ±f YapÄ±larÄ±**: `vtable` (virtual table) takibi yaparak sÄ±nÄ±flar arasÄ± kalÄ±tÄ±mÄ± (inheritance) Ã§Ã¶zme.
- **Dinamik Bellek YÃ¶netimi**: `malloc`/`free` dÃ¶ngÃ¼lerini izleyerek veri yapÄ±larÄ±nÄ± (Linked List, Trees) tanÄ±mlama.

### 2. Dinamik Deobfuscation (Åifre Ã‡Ã¶zme)
ZararlÄ± yazÄ±lÄ±m kendini bellekte aÃ§arken mÃ¼dahale etmek:
- **Memory Dump**: Malware ÅŸifreli string'lerini bellekte aÃ§tÄ±ÄŸÄ± anda (Ã¶rn: `CreateProcess` Ã§aÄŸrÄ±sÄ± Ã¶ncesi) bellek dÃ¶kÃ¼mÃ¼ alÄ±p `strings` ile incelemek.
- **Control Flow Flattening**: KarmaÅŸÄ±klaÅŸtÄ±rÄ±lmÄ±ÅŸ dallanmalarÄ± (jumps) anahtarlayarak kodun gerÃ§ek akÄ±ÅŸÄ±nÄ± (original control flow) bulma.

### 3. Kernel Debugging (Ring-0)
Ä°ÅŸletim sistemi Ã§ekirdeÄŸi seviyesindeki zararlÄ±larÄ± (Rootkits) analiz etmek iÃ§in **WinDbg** kullanarak Ã§ekirdek moduna geÃ§iÅŸ.

---

## ğŸ’» Modern YazÄ±lÄ±m Analizi: .NET & Golang

ZararlÄ± yazÄ±lÄ±mlar artÄ±k sadece C/C++ ile deÄŸil, daha karmaÅŸÄ±k yapÄ±lÄ± dillerle de yazÄ±lÄ±yor.

### 1. .NET Reversing (.NET Tersine MÃ¼hendislik)
C# veya VB.NET ile yazÄ±lan dosyalar makine koduna deÄŸil, `MSIL` (Intermediate Language) koduna derlenir.
- **AraÃ§lar**: `dnSpy` (Kodu neredeyse orijinal haline geri dÃ¶ndÃ¼rÃ¼r), `de4dot` (Obfuscation temizleyici).
- **ZayÄ±flÄ±k**: .NET dosyalarÄ±, tersine mÃ¼hendisliÄŸe karÅŸÄ± oldukÃ§a korumasÄ±zdÄ±r (eÄŸer Ã¶zel bir packer kullanÄ±lmadÄ±ysa).

### 2. Golang Malware Analizi
Go diliyle yazÄ±lan dosyalar "statik" olarak derlenir, bu da devasa dosya boyutlarÄ± ve karmaÅŸÄ±k fonksiyon yapÄ±larÄ± demektir.
- **Pattern**: Fonksiyon isimlerini ve tip bilgilerini (`gopclntab`) ayÄ±klamak iÃ§in Ã¶zel scriptler gerektirir.
- **Avantaj**: Cross-platform (Windows/Linux/Mac) saldÄ±rÄ±larÄ±nÄ± tek bir kod tabanÄ±yla yapmaya imkan tanÄ±r.

### 3. PowerShell Obfuscation (Deobfuscation)
- **Wrapper Temizleme**: `IEX` (Invoke-Expression) komutuyla gizlenmiÅŸ katmanlarÄ±, `Write-Host` ile deÄŸiÅŸtirerek gerÃ§ek scripti ekrana dÃ¶kme yÃ¶ntemi.

---

## ğŸ’» Sentinel Malware Hunter (Placeholder)

Statik analiz sÃ¼reÃ§lerini otomatize etmek iÃ§in geliÅŸtirilecek araÃ§larÄ±n merkezidir.

**Konum**: `TOOLS/sentinel_malware.py`
